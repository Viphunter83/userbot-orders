# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram

**–î–∞—Ç–∞:** 20 –Ω–æ—è–±—Ä—è 2025

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫:
- `socket.send() raised exception` - —Å–æ—Ç–Ω–∏ —Ä–∞–∑
- `Connection lost` - –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `Retrying "updates.GetChannelDifference"` - –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–≠—Ç–∏ –æ—à–∏–±–∫–∏ –∑–∞—Å–æ—Ä—è—é—Ç –ª–æ–≥–∏ –∏ —Å–æ–∑–¥–∞—é—Ç –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ö–æ—Ç—è –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. Rate Limiting –¥–ª—è –ª–æ–≥–æ–≤

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫:

- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:** 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
- **–°—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- **–£–º–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ socket –æ—à–∏–±–æ–∫

**–î–æ:**
- –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ `socket.send()` –ª–æ–≥–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫–∞–∫ WARNING
- –°–æ—Ç–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∑–∞—Å–æ—Ä—è–ª–∏ –ª–æ–≥–∏

**–ü–æ—Å–ª–µ:**
- –û—à–∏–±–∫–∏ `socket.send()` –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- –°–æ–æ–±—â–µ–Ω–∏–µ: "Socket connection issue (occurred X times) - this is normal during network fluctuations"

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ "Connection lost"

**–î–æ:**
- –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ "Connection lost" –ª–æ–≥–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫–∞–∫ WARNING

**–ü–æ—Å–ª–µ:**
- –û—à–∏–±–∫–∏ "Connection lost" –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥
- –°–æ–æ–±—â–µ–Ω–∏–µ: "Connection lost (occurred X times) - Pyrogram will automatically reconnect"

### 4. –û–±—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø–æ —Ç–∏–ø—É
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- –ù–µ –∑–∞—Å–æ—Ä—è—é—Ç –ª–æ–≥–∏ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è—Ö

---

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –∫–ª–∞—Å—Å–∞

```python
# Error tracking for rate limiting logs
self._error_counts = defaultdict(int)
self._error_last_logged = defaultdict(lambda: datetime.min)
self._error_log_interval = timedelta(seconds=30)
```

### –£–ª—É—á—à–µ–Ω exception_handler

```python
def exception_handler(loop, context):
    """Handle unhandled exceptions in asyncio tasks with rate limiting."""
    # Rate limiting logic
    # Smart logging based on error type
    # Debug level for common connection issues
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
socket.send() raised exception.
socket.send() raised exception.
socket.send() raised exception.
[10] Retrying "updates.GetChannelDifference" due to: Connection lost
socket.send() raised exception.
socket.send() raised exception.
... (—Å–æ—Ç–Ω–∏ —Å—Ç—Ä–æ–∫)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
2025-11-20 15:51:27 | DEBUG | Socket connection issue (occurred 150 times) - this is normal during network fluctuations
2025-11-20 15:51:57 | DEBUG | Connection lost (occurred 25 times) - Pyrogram will automatically reconnect
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ß–∏—Å—Ç—ã–µ –ª–æ–≥–∏:** –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—à–∏–±–∫–∏ –Ω–µ –∑–∞—Å–æ—Ä—è—é—Ç –≤—ã–≤–æ–¥
2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å:** –í–∏–¥–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –æ—à–∏–±–æ–∫
3. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å:** –Ø—Å–Ω–æ, —á—Ç–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–µ–Ω—å—à–µ –æ–ø–µ—Ä–∞—Ü–∏–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **Pyrogram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è** –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **Socket –æ—à–∏–±–∫–∏** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** –¥–∞–∂–µ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- **–õ–æ–≥–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG** –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
python3 -m src.main admin health-check

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—à–∏–±–æ–∫
python3 -m src.main admin error-stats
```

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 20 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

